// // This is your Prisma schema file,
// // learn more about it in the docs: https://pris.ly/d/prisma-schema

// // Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// // Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

// generator client {
//   provider = "prisma-client-js"
//   // output   = "../generated/prisma"
// }

// datasource db {
//   provider = "mongodb"
//   url      = env("DATABASE_URL")
// }

// model images {
//   id String @id @default(auto()) @map("_id") @db.ObjectId
//   file_id String
//   url String 
//   userId String? @db.ObjectId @unique
//   shopId String? @unique @db.ObjectId
//   users users? @relation(fields: [userId],references: [id])
//   shop shops? @relation(fields: [shopId],references: [id])
//   products products? @relation(fields: [productsId],references: [id])
//   productsId String? @db.ObjectId
// }

// model users {
//   id String @id @default(auto()) @map("_id") @db.ObjectId
//   name String
//   email String @unique
//   password String?
//   following String[]
//   avatar images? 
//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt
//   shopReviews shopReviews[]

// }

// model shopReviews {
// id String @id @default(auto()) @map("_id") @db.ObjectId
// userId String @db.ObjectId  
// user users @relation(fields: [userId],references: [id])
// rating Float
// reviews String?
// createdAt DateTime @default(now())
// updatedAt DateTime @updatedAt
// shopsId String? @db.ObjectId
// shops shops? @relation(fields: [shopsId],references: [id])

// }

// model shops {
// id String @id @default(auto()) @map("_id") @db.ObjectId
// name String 
// bio String?
// category String?
// avatar images? 
// coverBanner String?
// address String
// opening_hours String?
// website String?
// socialLinks Json[]
// ratings Float @default(0)
// reviews shopReviews[]
// sellerId String @unique @db.ObjectId
// sellers sellers @relation(fields: [sellerId],references: [id])
// createdAt DateTime @default(now())
// updatedAt DateTime @updatedAt
// products products[]
// }

// model sellers {
//   id String @id @default(auto()) @map("_id") @db.ObjectId
//   name String 
//   email String @unique
//   phone_number String 
//   country String 
//   password String 
//   stripeId String ?
//   shop shops? 
//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt
//   shopId String? @db.ObjectId
//   // shopsId String? @db.ObjectId
// }

model site_config {
 id String @id @default(auto()) @map("_id") @db.ObjectId
 categories String[]
 subCategories Json
}

// model discount_codes {
//   id String @id @default(auto()) @map("_id") @db.ObjectId
//   public_name String
//   discountType String
//   discountValue Float
//   discountCode String @unique
//   sellerId String @db.ObjectId
//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt

// }

// model products {
//   id                    String      @id @default(auto()) @map("_id") @db.ObjectId
//   title                 String
//   slug                  String      @unique
//   category              String
//   subCategory           String
//   short_description     String
//   detailed_description  String
//   images                images[]    // Assuming 'images' is another model or a custom type
//   video_url             String?     // Optional video URL
//   tags                  String[]     // Optional tags
//   brand                 String?     // Optional brand
//   colors                String[]    // Array of strings for colors
//   sizes                 String[]    // Array of strings for sizes
//   starting_date         DateTime?   // Optional starting date
//   ending_date           DateTime?   // Optional ending date
//   stock                 Int         // Number of items in stock
//   sale_price            Float       // Sale price
//   regular_price         Float       // Regular price
//   ratings               Float       @default(5) // Default rating of 5
//   warranty              String?     // Optional warranty information
//   custom_specifications Json?       // Optional JSON for custom specifications
//   custom_properties     Json        // JSON for custom properties
//   isDeleted             Boolean?    @default(false) // Soft delete flag
//   cashOnDelivery        String?     // Optional cash on delivery status/info
//   discount_codes        String[]    @db.ObjectId // Array of ObjectIds for discount codes
//   status                productStatus @default(Active) // Status of the product, using an enum
//   deletedAt             DateTime?   // Timestamp for when the product was deleted
//   createdAt             DateTime    @default(now()) // Timestamp for creation
//   updatedAt             DateTime    @updatedAt // Timestamp for last update
//   shopId                String      @db.ObjectId // Foreign key for shop
//   Shop                  shops       @relation(fields: [shopId], references: [id]) // Relation to the 'shops' model
//   totalSales            String?
// }

// // Assuming productStatus is an enum defined elsewhere in your schema
// enum productStatus {
//   Active
//   Inactive
//   Draft

// }

// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  // output   = "../generated/prisma"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model images {
  id         String    @id @default(auto()) @map("_id") @db.ObjectId
  file_id    String
  url        String
  userId     String?    @db.ObjectId
  shopId     String?    @db.ObjectId
  sellerId   String?     @db.ObjectId
  sellers      sellers?  @relation(fields: [sellerId], references: [id])
  users      users?    @relation(fields: [userId], references: [id])
  shop       shops?    @relation(fields: [shopId], references: [id])
  products   products? @relation(fields: [productsId], references: [id])
  productsId String?   @db.ObjectId
  imageType String?    
}

model users {
  id            String          @id @default(auto()) @map("_id") @db.ObjectId
  googleId      String?         
  name          String
  email         String          @unique
  password      String?
  following     String[]
  avatar        images[]
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  shopReviews   shopReviews[]
  userAnalytics UserAnalytics[]
  country String?
  dob DateTime?
  phone String?
  reviews reviews[]
  orders orders[]
}
 
model reviews {
  id String @id @default(auto()) @map("_id") @db.ObjectId
  comment String
  rating Int 
  isVerifiedPurchase Boolean
  userId String @db.ObjectId 
  users users @relation(fields: [userId],references: [id])
  productId String @db.ObjectId
  products products @relation(fields: [productId],references: [id])
  createdAt DateTime
  updatedAt DateTime @updatedAt
  
  

  
}


model shopReviews {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  user      users    @relation(fields: [userId], references: [id])
  rating    Float
  reviews   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  shopId   String?  @db.ObjectId
  shops     shops?   @relation(fields: [shopId], references: [id])

  
}

model shops {
  id               String             @id @default(auto()) @map("_id") @db.ObjectId
  name             String
  bio              String?
  category         String?
  avatar           images[]
  coverBanner      String?
  address          String
  opening_hours    String?
  website          String?
  socialLinks      Json[]
  ratings          Float              @default(0)
  reviews          shopReviews[]
  sellerId         String             @unique @db.ObjectId
  sellers          sellers            @relation(fields: [sellerId], references: [id])
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  products         products[]
  productAnalytics ProductAnalytics[]
  orders           orders[]
}

model sellers {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  name         String
  email        String   @unique
  phone_number String
  country      String
  password     String
  stripeId     String?
  shop         shops?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  shopId       String?  @db.ObjectId
  avatar       images[]
}

// model site_config {
//   id            String   @id @default(auto()) @map("_id") @db.ObjectId
//   categories    String[]
//   subCategories Json
// }

model discount_codes {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  public_name   String
  discountType  String
  discountValue Float
  discountCode  String   @unique
  sellerId      String   @db.ObjectId
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model products {
  id                    String            @id @default(auto()) @map("_id") @db.ObjectId
  title                 String
  slug                  String            @unique
  category              String
  subCategory           String
  short_description     String
  detailed_description  String
  images                images[] // Assuming 'images' is another model or a custom type
  video_url             String? // Optional video URL
  tags                  String[] // Optional tags
  brand                 String? // Optional brand
  colors                String[] // Array of strings for colors
  sizes                 String[] // Array of strings for sizes
  starting_date         DateTime? // Optional starting date
  ending_date           DateTime? // Optional ending date
  stock                 Int // Number of items in stock
  sale_price            Float // Sale price
  regular_price         Float // Regular price
  ratings               Float             @default(0) // Default rating of 5
  warranty              String? // Optional warranty information
  custom_specifications Json? // Optional JSON for custom specifications
  custom_properties     Json // JSON for custom properties
  isDeleted             Boolean?          @default(false) // Soft delete flag
  cashOnDelivery        String? // Optional cash on delivery status/info
  discount_codes        String[]          @db.ObjectId // Array of ObjectIds for discount codes
  status                productStatus     @default(Active) // Status of the product, using an enum
  deletedAt             DateTime? // Timestamp for when the product was deleted
  createdAt             DateTime          @default(now()) // Timestamp for creation
  updatedAt             DateTime          @updatedAt // Timestamp for last update
  shopId                String            @db.ObjectId // Foreign key for shop
  Shop                  shops             @relation(fields: [shopId], references: [id]) // Relation to the 'shops' model
  totalSales            Int?
  analytics             ProductAnalytics?
  reviews reviews[]
}

// Assuming productStatus is an enum defined elsewhere in your schema
enum productStatus {
  Active
  Inactive
  Draft
}

model ProductAnalytics {
  id           String    @id @default(auto()) @map("_id") @db.ObjectId
  productId    String    @unique @db.ObjectId
  product      products  @relation(fields: [productId], references: [id])
  shopId       String    @db.ObjectId
  shop         shops     @relation(fields: [shopId], references: [id])
  views        Int       @default(0)
  cartAdds     Int       @default(0)
  wishListAdds Int       @default(0)
  purchases    Int       @default(0)
  lastViewedAt DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model UserAnalytics {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  // Relation to your existing 'users' model
  userId String @unique @db.ObjectId
  user   users  @relation(fields: [userId], references: [id])

  // Timestamps from your document
  lastVisited DateTime
  lastTrained DateTime? // Optional as it might not always exist
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // User context fields
  country String?
  city    String?
  device  String?

  // The embedded array of actions, using the 'Action' composite type below
  actions Json?
}

// Define the composite type for the objects inside the 'actions' array
type Action {
  productId String     @db.ObjectId
  shopId    String     @db.ObjectId
  action    ActionType
  timestamp DateTime
}

enum ActionType {
  add_to_wishlist
  add_to_cart
  view_product
  purchase
}

enum addressType {
  Home
  Work
  Other
}

model address {
  id        String      @id @default(auto()) @map("_id") @db.ObjectId
  userId    String      @db.ObjectId
  label     addressType
  name      String
  street    String
  city      String
  zip       String
  country   String
  isDefault Boolean     @default(true)
  createdAt DateTime    @default(now())
}

model orders {
  id                String       @id @default(auto()) @map("_id") @db.ObjectId
  userId            String       @db.ObjectId
  users             users        @relation(fields: [userId], references: [id])
  shopId            String       @db.ObjectId
  shop              shops        @relation(fields: [shopId], references: [id])
  total             Float
  shippingAddressId String?
  couponCode        String?
  discountAmount    Float?
  status            String
  deliveryStatus    orderStatus       @default(Ordered)
  items             orderItems[] @relation("OrderItemsRelation")
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
}
enum orderStatus {
  Ordered
  Packed
  Shipped
  OutForDelivery @map("Out for Delivery") 
  Delivered
  Processing
  Paid
  Cancelled
}
model orderItems {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  orderId         String   @db.ObjectId
  productId       String
  quantity        Int
  price           Float
  selectedOptions Json?
  orders          orders   @relation(fields: [orderId], references: [id], name: "OrderItemsRelation")
  createdAt       DateTime @default(now())
}

model uniqueShopVisitors {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  shopId    String   @db.ObjectId
  userId    String   @db.ObjectId
  visitCount BigInt   @default(0) 
  visitedAt DateTime @default(now())

  @@unique([shopId, userId])
}

model notifications {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  creatorId     String    @db.ObjectId
  receiverId    String
  redirect_link String?
  title         String
  message       String
  status        String    @default("Unread")
  cratedAt      DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model message {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  conversationId String   @db.ObjectId
  senderId       String   @db.ObjectId
  senderType     String
  content        String?
  attachments    String[]
  status         String   @default("sent")
  createdAt      DateTime @default(now())

  @@unique([conversationId, senderId, content, createdAt])
}

model conversationGroup {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  isGroup        Boolean   @default(false)
  name           String?
  creatorId      String
  participantIds String[]  @db.ObjectId
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
}

model participant {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  conversationId String    @db.ObjectId
  userId         String?   @db.ObjectId
  sellerId       String?   @db.ObjectId
  lastSeenAt     DateTime?
  isOnline       Boolean   @default(false)
  unreadCount    Int       @default(0)
  muted          Boolean   @default(false)
  joinedAt       DateTime  @default(now())
}


// model productAnalytics {
//   id             String   @id @default(auto()) @map("_id") @db.ObjectId
//   productId      String   @unique
//   shopId         String
//   views          Int      @default(0)
//   cartAdds       Int      @default(0)
//   wishlistAdds   Int      @default(0)
//   purchases      Int      @default(0)
//   lastViewedAt   DateTime
//   createdAt      DateTime @default(now())
//   updatedAt      DateTime @updatedAt
// }

// model shopAnalytics {
//   id             String   @id @default(auto()) @map("_id") @db.ObjectId
//   totalVisitors  Int      @default(0)
//   countryStats   Json?
//   cityStats      Json?
//   deviceStats    Json?
//   lastVisitedAt  DateTime
//   createdAt      DateTime @default(now())
//   updatedAt      DateTime @updatedAt
// }

// model userAnalytics {
//   id              String   @id @default(auto()) @map("_id") @db.ObjectId
//   userId          String   @unique
//   country         String?
//   city            String?
//   device          String?
//   lastVisited     DateTime
//   actions         Json?
//   recommendations Json?
//   lastTrained     DateTime @default(now())
//   createdAt       DateTime @default(now())
//   updatedAt       DateTime @updatedAt
// }

// model followers {
//   userId  String @db.ObjectId
//   shopsId String @db.ObjectId
//   user    users  @relation(fields: [userId], references: [id])
//   shops   shops? @relation(fields: [shopsId], references: [id])

//   @@unique([userId, shopsId])
// }

// model uniqueShopVisitors {
//   id        String   @id @default(auto()) @map("_id") @db.ObjectId
//   shopId    String   @db.ObjectId
//   userId    String   @db.ObjectId
//   visitedAt DateTime @default(now())

//   @@unique([shopId, userId])
// }

// model discount_codes {
//   id            String   @id @default(auto()) @map("_id") @db.ObjectId
//   public_name   String
//   discountType  String
//   discountValue Float
//   discountCode  String   @unique
//   sellerId      String   @db.ObjectId
//   createdAt     DateTime @default(now())
//   updatedAt     DateTime @updatedAt
// }
